<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Nutanix Intentful API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;,&quot;python&quot;,&quot;powershell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="powershell">powershell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>The Nutanix intentful API moves programming from the user to the machine.</p>

<p>We have language bindings in Shell, Python, and Powershell. You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>

<h1 id="authentication">Authentication</h1>

<p>You can create an authorized session to a Nutanix cluster.</p>

<blockquote>
<p>To authorize, use this code:</p>
</blockquote>
<pre class="highlight python"><code><span class="k">class</span> <span class="nc">TestRestApi</span><span class="p">():</span>                
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">serverIpAddress</span> <span class="o">=</span> <span class="s">"ip_address"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s">"cluster_username"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">"cluster_password"</span>
    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">'https://</span><span class="si">%</span><span class="s">s:9440/PrismGateway/services/rest/v1/'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">BASE_URL</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">serverIpAddress</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_server_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
</code></pre>
<pre class="highlight powershell"><code><span class="nv">$ipAddress</span> <span class="o">=</span> <span class="s2">"ip_address"</span>
<span class="nv">$clusterUserName</span> <span class="o">=</span> <span class="s2">"cluster_username"</span>
<span class="nv">$clusterPassword</span> <span class="o">=</span> <span class="s2">"cluster_password"</span>
Connect-NutanixCluster -Server <span class="nv">$ipAddress</span> -UserName <span class="nv">$clusterUserName</span> <span class="sb">`</span>
  -Password <span class="nv">$clusterPassword</span> -AcceptInvalidSSLCerts
</code></pre>
<pre class="highlight shell"><code><span class="c"># With shell, you can just pass the correct header with each request</span>
curl <span class="s2">"api_endpoint_here"</span>
  -H <span class="s2">"Authorization: meowmeowmeow"</span>
</code></pre>

<aside class="warning">Do not put your cluster password in plain text inside a script. The code samples are for reference only.</aside>

          <h1 id="networks">Networks</h1>

<h2 id="get-details-for-a-network">Get details for a network</h2>
<pre class="highlight python"><code><span class="n">clusterURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="s">"/networks"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_uuid</span>
<span class="k">print</span> <span class="s">"Getting cluster information for cluster </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">serverIpAddress</span>
<span class="n">serverResponse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">clusterURL</span><span class="p">)</span>
<span class="k">return</span> <span class="n">serverResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serverResponse</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET /networks/{uuid}</code></p>

<h3 id="query-parameters">Query parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>implied</td>
<td>UUID of the network</td>
<td>#/definitions/network</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<table><thead>
<tr>
<th>Response Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Success</td>
</tr>
<tr>
<td>default</td>
<td>Error schema: #/definitions/network_status</td>
</tr>
</tbody></table>

<h2 id="modify-network">Modify network</h2>
<pre class="highlight python"><code><span class="n">clusterURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="s">"/networks"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_uuid</span>
<span class="k">print</span> <span class="s">"Getting cluster information for cluster </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">serverIpAddress</span>
<span class="n">serverResponse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">clusterURL</span><span class="p">)</span>
<span class="k">return</span> <span class="n">serverResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serverResponse</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>

<h3 id="http-request">HTTP request</h3>

<p><code class="prettyprint">PUT /networks/{uuid}</code></p>

<h3 id="query-parameters">Query parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>implied</td>
<td>UUID of the network</td>
<td>#/definitions/network</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<table><thead>
<tr>
<th>Response Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Success</td>
</tr>
<tr>
<td>default</td>
<td>Error schema: #/definitions/network_status</td>
</tr>
</tbody></table>

<h2 id="delete-a-network">Delete a network</h2>
<pre class="highlight python"><code><span class="n">clusterURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="s">"/networks"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_uuid</span>
<span class="k">print</span> <span class="s">"Getting cluster information for cluster </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">serverIpAddress</span>
<span class="n">serverResponse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">clusterURL</span><span class="p">)</span>
<span class="k">return</span> <span class="n">serverResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serverResponse</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE /networks/{uuid}</code></p>

<h3 id="query-parameters">Query parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>implied</td>
<td>UUID of the network</td>
<td>#/definitions/network</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<table><thead>
<tr>
<th>Response Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Success</td>
</tr>
<tr>
<td>default</td>
<td>Error schema: #/definitions/network_status</td>
</tr>
</tbody></table>

          <h1 id="schemas">Schemas</h1>

<h2 id="create-network-request">Create network request</h2>

<table>
    <tr>
        <th>Description</th>
        <td>Request to make a network</td>
    </tr>
    <tr>
        <th>Name</th>
        <td>network</td>
    </tr>
    <tr>
        <th>Type</th>
        <td>object</td>
    </tr>
</table>

<h3 id="properties">Properties</h3>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required?</th>
</tr>
</thead><tbody>
<tr>
<td>api_version</td>
<td>string</td>
<td>*</td>
</tr>
<tr>
<td>metadata</td>
<td>#/definitions/network_metadata</td>
<td>*</td>
</tr>
<tr>
<td>spec</td>
<td>#/definitions/network_resources</td>
<td></td>
</tr>
<tr>
<td>status</td>
<td>#/definitions/network_resources</td>
<td></td>
</tr>
</tbody></table>

<h2 id="response-kind">Response Kind</h2>

<table>
    <tr>
        <th>Description</th>
        <td>The status of a REST API call. Only used when there is a failure to report.</td>
    </tr>
    <tr>
        <th>Name</th>
        <td>network_status</td>
    </tr>
    <tr>
        <th>Type</th>
        <td>object</td>
    </tr>
</table>

<h3 id="properties">Properties</h3>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
<th>Read only?</th>
</tr>
</thead><tbody>
<tr>
<td>api_version</td>
<td></td>
<td>string</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>code</td>
<td>The HTTP error code</td>
<td>integer</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>details</td>
<td>Custom key-value details relevant to the status</td>
<td>object (string)</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>kind</td>
<td>The kind name</td>
<td>string</td>
<td>network</td>
<td>*</td>
</tr>
<tr>
<td>message</td>
<td>A sentence explaining the reason for the status</td>
<td>string</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>reason</td>
<td>One snake_case word</td>
<td>string</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>status</td>
<td>Only value possible is &ldquo;failure&rdquo;</td>
<td>string</td>
<td></td>
<td>*</td>
</tr>
</tbody></table>

<h2 id="network-metadata">Network metadata</h2>

<table>
    <tr>
        <th>Description</th>
        <td>The network kind metadata</td>
    </tr>
    <tr>
        <th>Name</th>
        <td>network_metadata</td>
    </tr>
    <tr>
        <th>Type</th>
        <td>object</td>
    </tr>
</table>

<h3 id="properties">Properties</h3>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
<th>Read only?</th>
</tr>
</thead><tbody>
<tr>
<td>last_update_time</td>
<td>Time when network was last updated</td>
<td>string</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>kind</td>
<td>The kind name</td>
<td>string</td>
<td>network</td>
<td>*</td>
</tr>
<tr>
<td>uuid</td>
<td>network uuid</td>
<td>string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>creation_time</td>
<td>Time when network was created</td>
<td>string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>account_reference</td>
<td>See schema definition</td>
<td>#/definitions/account_reference</td>
<td></td>
<td></td>
</tr>
<tr>
<td>owner_reference</td>
<td>See schema definition</td>
<td>#/definitions/user_reference</td>
<td></td>
<td></td>
</tr>
<tr>
<td>entity_version</td>
<td>Monotonically increasing number</td>
<td>integer</td>
<td></td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>network name</td>
<td>string</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<h1 id="patterns">Patterns</h1>

<p>UUID: ^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$</p>

          <h1 id="status-codes">Status codes</h1>

<p>The Nutanix intentful API uses the following error codes:</p>

<table><thead>
<tr>
<th>Status Code</th>
<th>Definition</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>The API request was successful and received a response.</td>
</tr>
<tr>
<td>201</td>
<td>The API request was successful and created an object.</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Status Code</th>
<th>Definition</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>The API request was malformed and could not be processed.</td>
</tr>
<tr>
<td>401</td>
<td>You have no access and/or are not authorized.</td>
</tr>
<tr>
<td>403</td>
<td>You are authorized but do not have the privileges for this API.</td>
</tr>
<tr>
<td>404</td>
<td>The URL was not found.</td>
</tr>
<tr>
<td>405</td>
<td>The called method is not allowed or is not supported.</td>
</tr>
<tr>
<td>408</td>
<td>The request timed out (20 seconds maximum).</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Status Code</th>
<th>Definition</th>
</tr>
</thead><tbody>
<tr>
<td>500</td>
<td>The API request was received but there was a server error.</td>
</tr>
<tr>
<td>503</td>
<td>Service unavailable at this time or too early to process.</td>
</tr>
<tr>
<td>505</td>
<td>HTTP other than 1.1 not supported.</td>
</tr>
</tbody></table>

          <h1 id="protection-domain-tutorial-v2">Protection Domain Tutorial (v2)</h1>

<p>This REST API Python tutorial shows you how to: define cluster connection, authenticate to a cluster, get cluster information, create a protection domain, find unprotected VMs, and add the unprotected VMs to a protection domain.</p>

<h2 id="before-you-begin">Before you begin</h2>

<p>Install Python library requests.</p>

<p>You can download the completed script at https://github.com/nutanix/Connection-viaREST/blob/master/api_python_authenticate_pd.py.</p>

<p>You can download the sample response to this script at https://github.com/nutanix/Connection-viaREST/blob/master/api_python_authenticate_pd_sample_response.txt.</p>

<ol>
<li><p>Import the modules for the Python code. The following modules should be included in your script:</p></li>
<li><p>Authenticate cluster connection by defining the following parameters.
Define the cluster IP address, user name, password, and base URL.
The BASE_URL = &lsquo;https://%s:9440/PrismGateway/services/rest/v1/&rsquo; line sets up the REST services that are hosted in Prism Gateway.</p></li>
</ol>

<p>- Replace ip_address with the cluster virtual IP address.
    - Replace cluster_username with the cluster user name.
    - Replace cluster_password with the cluster password.</p>

<ol>
<li> Create a REST client session for a server connection.
If using a self-signed certificate, disable the SSL certificate verification by setting it to FALSE. Without disabling the SSL certificate verification, the script will not run on the interface.</li>
</ol>
<pre class="highlight python"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="k">class</span> <span class="nc">TestRestApi</span><span class="p">():</span>                
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">serverIpAddress</span> <span class="o">=</span> <span class="s">"ip_address"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s">"cluster_username"</span>
<span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">"cluster_password"</span>
    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">'https://</span><span class="si">%</span><span class="s">s:9440/PrismGateway/services/rest/v1/'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">BASE_URL</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">serverIpAddress</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_server_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_server_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="bp">False</span>                                            
    <span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span><span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json; charset=utf-8'</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">session</span>
</code></pre>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="powershell">powershell</a>
          </div>
      </div>
    </div>
  </body>
</html>
